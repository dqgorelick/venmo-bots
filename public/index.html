<!DOCTYPE html>
<html>

<head>
    <title>React Webpack Scaffold</title>
    <link rel="stylesheet" href="./dist/main.css">
    <script src='../javascripts/jquery.min.js'></script>
    <script src='../javascripts/dom-to-image.min.js'></script>
</head>

<body>
    <div class="dev">
      <button id="render">Render</button>
      <button id="upload">Send to server</button>
    </div>
    <div class="result-wrapper">
      <div class="result"></div>
    </div>
    <div id="app">
        <h2>React Webpack Scaffold</h2>
        <p>NOT WORKING</p>
    </div>
    <script src="./dist/bundle.js"></script>
    <script>
    (function() {
      var cats = 12;
      document.getElementById('render').addEventListener('click', function() {
          var node = document.querySelector('.comic-container');
          domtoimage.toPng(node)
              .then(function(dataUrl) {
                  var img = new Image();
                  img.src = dataUrl;
                  document.querySelector('.result').innerHTML = '';
                  document.querySelector('.result').appendChild(img);
              })
              .catch(function(error) {
                  console.error('oops, something went wrong!', error);
              });
      });
      // document.getElementById('upload').addEventListener('click', function() {
      //     $.post('http://localhost:9000/api/upload', { data: 'hello' }, function(data) {
      //       console.log('data',data);
      //     });
      // });

      // var RASPBERRY_PI_IP = '192.168.1.237';
      // var MAC_IP = '192.168.1.237';
      var RASPBERRY_PI_IP = 'localhost';
      var MAC_IP = 'localhost';

      document.getElementById('upload').addEventListener('click', function() {
        var image = document.querySelector('.result img');
        var dataURL = $('.result img').attr('src');
        console.log('dataURL',dataURL);
        if (image) {
          // save image
          $.ajax({
            type: 'POST',
            url: 'http://'+ MAC_IP + ':9000/api/upload',
            // url: 'http://192.168.1.210:9000/api/upload',
            data: JSON.stringify({dataURL: dataURL}),
            contentType: 'application/json',
            success: function(resultData) { console.log("Save Complete") },
            error: function() { console.log("Something went wrong")}
          });

          // print
          // $.ajax({
          //   type: 'POST',
          //   url: 'http://' + MAC_IP + ':9999/api/print',
          //   // url: 'http://192.168.1.210:9000/api/upload',
          //   data: JSON.stringify({dataURL: dataURL}),
          //   contentType: 'application/json',
          //   success: function(resultData) { console.log("printing!") },
          //   error: function() { console.log("error printing")}
          // });
        } else {
          alert('no image');
        }
      });
    })();
    </script>
</body>

</html>
