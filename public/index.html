<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Venmo Strips</title>
    <meta content="text/html">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="./dist/main.css">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <script src='../javascripts/jquery.min.js'></script>
    <script src='../javascripts/html2canvas.min.js'></script>
</head>

<body>
    <div class='save-wrapper'>
      <div class="save-modal">
        <h1>Final Comic!</h1>
        <div class="final_comic"></div>
        <div class="re-roll close">
          <span>Close</span>
        </div>
      </div>
    </div>
    <div class='reload'>
      <div class="reloading">
        <h1>Get most recent Venmo payments?</h1>
        <div class='buttons'>
          <button class='button-yes'>Yes</button>
          <br>
          <br>
          <button class='button-no'>Not yet</button>
        </div>
      </div>
    </div>
    <div id="app">
        <div className="content-wrapper">
          <h1>Venmo Strips Generator</h1>
          <p>
            Creating comics from a continuous feed of
            user generated content.
          </p>
          <br>
          <strong>
            <p>Please refresh page</p>
          </strong>
        </div>
    </div>
    <script src="./dist/bundle.js"></script>
    <script>
    $(document).ready(function() {
      function checkWidth() {
        (window.innerWidth < 750 ? $('.comic').addClass('smaller') : $('.comic').removeClass('smaller'));
      }
      checkWidth();
      $(window).on('resize', function() {
        checkWidth();
      })
      $('.print').on('click', function() {
        console.log('touched!');
        $('.printing-status').css('display','initial');
        var node = document.querySelector('.comic');
        html2canvas(node, {useCORS: true}).then(function (canvas) {
          try {
            b64Data = canvas.toDataURL("image/png");
            var img = new Image();
            img.src = b64Data;
            document.querySelector('.final_comic').innerHTML = '';
            document.querySelector('.final_comic').appendChild(img);
          } catch (err) {
            console.log('err',err);
          }
        });
      });
      $('.close').click(function(){
        $('.printing-status').css('display','none');
      })
      $('.button-yes').click(function(){
        location.reload();
      });
      $('.button-no').click(function(){
        $('.reload').css('display', 'none');
        reloadCount = 0;
        clearInterval(resetCount);
      });
      var resetCount;
      var reloadCount = 0;
      // reload every 3 minutes
      setInterval(function() {
        $('.reload').css('display', 'initial');
        resetCount = setInterval(function(){
          reloadCount+=1;
          if (reloadCount > 10) {
            location.reload();
          }
        }, 1000);
      }, 1000*60*3);
    });
    </script>
</body>

</html>
